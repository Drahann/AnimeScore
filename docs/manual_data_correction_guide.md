# 手动数据修正脚本使用指南

## 📋 概述

`manual_data_correction.py` 是专门用于修正搜索错误导致的数据问题的脚本。当爬虫搜索到错误的网页时，可能会导致评分、投票数或网址等数据错误，这个脚本可以帮你手动修正这些问题。

## 🎯 适用场景

### 常见的数据错误类型
1. **搜索到错误的动漫页面** - 同名或相似名称的不同作品
2. **评分数据错误** - 网站更新导致的评分变化
3. **投票数错误** - 投票数统计不准确
4. **网址错误** - 指向错误的页面链接
5. **重复数据** - 同一动漫被重复统计

### 典型使用情况
- 发现某个动漫的 MAL 评分明显不对
- 某个网站的链接指向了错误的页面
- 投票数异常（过高或过低）
- 需要删除某个网站的错误数据

## 🚀 使用方法

### 基本用法
```bash
# 自动选择最新文件进行修正
python scripts/manual_data_correction.py

# 指定特定文件进行修正
python scripts/manual_data_correction.py -i "data/results/final_results/anime_ranking_Summer_2025_*.json"

# 启用详细日志
python scripts/manual_data_correction.py -v
```

### 命令行参数
- `-c, --config` - 配置文件路径（默认: config/config.yaml）
- `-i, --input` - 输入文件路径（默认: 自动选择最新文件）
- `-o, --output` - 输出目录（默认: final_results目录）
- `-f, --formats` - 输出格式（默认: json,csv）
- `-v, --verbose` - 启用详细日志

## 📖 操作流程

### 1. 启动脚本
```bash
python scripts/manual_data_correction.py
```

### 2. 浏览动漫列表
脚本会显示所有动漫的列表，包括：
- 编号
- 动漫标题（中文、英文、日文）
- 评分网站数量
- 评分概览

### 3. 选择要修正的动漫
输入动漫编号来选择要修正的动漫，输入 `0` 退出。

### 4. 查看详细信息
脚本会显示选中动漫的详细信息：
- 基本信息（标题、类型、集数等）
- 所有网站的评分数据
- 每个网站的URL

### 5. 修正数据
对于每个网站的数据，你可以：

#### 修正评分
```
新评分 (当前: 8.5, 回车保持不变): 8.2
```

#### 修正投票数
```
新投票数 (当前: 1,234, 回车保持不变): 1500
```

#### 修正URL
```
新URL (当前: https://..., 回车保持不变): https://correct-url.com
```

#### 特殊操作
- 输入 `skip` - 跳过当前网站
- 输入 `delete` - 删除当前网站的数据

### 6. 保存结果
修正完成后，脚本会：
- 重新计算综合评分
- 重新排名
- 保存到 `final_results` 目录

## 💡 使用技巧

### 识别错误数据
1. **异常评分** - 与其他网站评分差异过大
2. **异常投票数** - 明显过高或过低
3. **错误URL** - 检查链接是否指向正确页面
4. **重复数据** - 同一动漫有多个相同网站的数据

### 修正策略
1. **对比多个网站** - 确认哪个数据是错误的
2. **检查原始网页** - 访问URL确认数据准确性
3. **保守修正** - 不确定时保持原数据不变
4. **记录修改** - 记住修改了什么，便于后续验证

### 批量操作
- 可以连续修正多个动漫
- 每次修正后询问是否继续
- 支持部分修正（只修正有问题的网站）

## 📁 输出文件

### 文件命名
```
anime_ranking_{season}_{year}_data_corrected_{timestamp}.json
anime_ranking_{season}_{year}_data_corrected_{timestamp}.csv
```

### 文件内容
- 包含所有修正后的数据
- 重新计算的综合评分和排名
- 修正时间戳和标记

## 🔄 工作流程集成

### 完整的数据处理流程
```
1. 季度分析 → 原始数据
2. 删除动漫 → 删除不需要的动漫
3. 数据修正 → 修正错误数据 ← 这个脚本
4. 数据补全 → 补全缺失数据
```

### 与其他脚本的关系
- **输入**: 来自删除动漫后的结果
- **输出**: 供数据补全脚本使用
- **优先级**: 在数据补全之前进行

## ⚠️ 注意事项

### 数据安全
- 原始文件不会被修改
- 修正结果保存为新文件
- 包含时间戳，便于版本管理

### 修正原则
- **准确性优先** - 确保修正后的数据是正确的
- **保守修正** - 不确定时不要修改
- **记录变更** - 记住修改了什么

### 常见问题
1. **找不到文件** - 确保有可用的分析结果文件
2. **权限问题** - 确保有写入 final_results 目录的权限
3. **数据格式** - 确保输入文件格式正确

## 📊 示例场景

### 场景1: 修正错误的MAL评分
```
发现: "某动漫" 的 MAL 评分显示为 9.5，但实际应该是 8.5
操作: 选择该动漫 → 修正 MAL 评分 → 保存
结果: 重新计算排名，该动漫排名下降
```

### 场景2: 删除错误的网站数据
```
发现: "某动漫" 的 AniList 数据指向了错误的页面
操作: 选择该动漫 → 对 AniList 数据输入 "delete" → 保存
结果: 该动漫不再包含错误的 AniList 数据
```

### 场景3: 修正网址
```
发现: "某动漫" 的 Bangumi 链接指向了错误的页面
操作: 选择该动漫 → 修正 Bangumi URL → 保存
结果: URL 更新为正确链接
```

---

**这个脚本是数据质量保证的重要工具，确保最终排名的准确性和可靠性！**
